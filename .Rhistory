roxygen2::roxygenise()
rlang::last_trace()
rlang::last_trace()
roxygen2::roxygenise()
roxygen2::roxygenise()
source("~/projects/privat/EventStudy/R/models.R")
ComparisonPeriodMeanAdjustedModel <- R6Class("ComparisonPeriodMeanAdjustedModel",
inherit = ModelBase,
public = list(
model_name = "ComparisonPeriodMeanAdjustedModel",
fit = function(data_tbl) {
data_tbl %>%
filter(estimation_window == 1) %>%
.[['index_returns']] %>%
mean(.) -> reference_mean
private$.fitted_model = reference_mean
private$.is_fitted = TRUE
},
abnormal_returns = function(data_tbl) {
data_tbl %>%
mutate(abnormal_returns = firm_returns - private$.fitted_model)
}
)
)
MarketAdjustedModel <- R6Class("MarketAdjustedModel",
inherit = ModelBase,
public = list(
model_name = "MarketAdjustedModel",
fit = function(data_tbl) {
# do nothing
private$.is_fitted = TRUE
},
abnormal_returns = function(data_tbl) {
data_tbl %>%
mutate(abnormal_returns = firm_returns - index_returns)
}
))
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
roxygen2::roxygenise()
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
roxygen2::roxygenise()
?MarketModel
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
roxygen2::roxygenise()
warnings()
roxygen2::roxygenise()
source("~/projects/privat/EventStudy/R/models.R")
roxygen2::roxygenise()
?ModelBase
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
roxygen2::roxygenise()
warnings()
source("~/projects/privat/EventStudy/R/models.R")
warnings()
roxygen2::roxygenise()
warnings()
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
roxygen2::roxygenise()
warnings()
library(EventStudy)
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
roxygen2::roxygenise()
pkgload::dev_help('ModelBase')
source("~/projects/privat/EventStudy/R/models.R")
pkgload::dev_help('ModelBase')
roxygen2::roxygenise()
warnings()
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
roxygen2::roxygenise()
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
roxygen2::roxygenise()
warnings()
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
roxygen2::roxygenise()
warnings()
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
warnings()
roxygen2::roxygenise()
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
class(SimpleReturn$new())
is(SimpleReturn$new(), "ReturnCalculation")
is(MarketModel$new(), "ReturnCalculation")
class(MarketModel$new())
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
```{r}
library(tidyquant)
library(dplyr)
library(purrr)
library(readr)
library(DT)
library(EventStudy)
index_symbol = c("^GDAXI")
index_symbol = c("SPY")
firm_symbols = c("VOW.DE", "PAH3.DE", "BMW.DE", "MBG.DE")
firm_symbols = c("DRMA")
group <- c(rep("VW Group", 2), rep("Other", 2))
request_tbl <- cbind(c(1:4), firm_symbols, rep(index_symbol, 4),
rep("18.09.2015", 4),
group, rep(-10, 4), rep(10, 4), rep(-11, 4), rep(250, 4)) |>
as_tibble()
group <- c(rep("Other", 1))
request_tbl <- cbind(c(1), firm_symbols, rep(index_symbol, 1),
rep("14.04.2023", 1),
group, rep(-5, 1), rep(5, 1), rep(-11, 1), rep(250, 1)) |>
as_tibble()
names(request_tbl) <- c("event_id", "firm_symbol", "index_symbol", "event_date",
"group", "event_window_start", "event_window_end",
"shift_estimation_window", "estimation_window_length")
firm_symbols |>
tidyquant::tq_get(from = "2022-01-01", to = today()) |>
dplyr::mutate(date = format(date, "%d.%m.%Y")) |>
dplyr::select(symbol, date, adjusted) -> firm_tbl
index_symbol |>
tidyquant::tq_get(from = "2022-01-01", to = today()) |>
dplyr::mutate(date = format(date, "%d.%m.%Y")) |>
dplyr::select(symbol, date, adjusted) -> index_tbl
# Parametrization of the Event Study
log_return = LogReturn$new()
market_model = MarketModel$new()
# Define single event test statistic
ar_test = ARTTest$new()
car_test = CARTTest$new()
# Setup parameter set
param_set = ParameterSet$new(return_calculation  = log_return,
return_model        = market_model,
ar_test_statistics  = ar_test,
car_test_statistics = car_test)
est_task = EventStudyTask$new(firm_tbl, index_tbl, request_tbl)
est_task = EventStudyTask$new(firm_tbl, index_tbl, request_tbl)
index_tbl
firm_tbl
request_tbl
request_tbl %>%
dplyr::select(firm_symbol, index_symbol)
request_tbl %>%
dplyr::select(firm_symbol, index_symbol) -> request_join_idx_tbl
firm_tbl %>%
dplyr::left_join(request_join_idx_tbl, by = "firm_symbol")
firm_tbl
firm_tbl %>%
dplyr::left_join(request_join_idx_tbl, by = c("symbol" = "firm_symbol"))
index_tbl
firm_tbl %>%
dplyr::left_join(request_join_idx_tbl, by = c("symbol" = "firm_symbol")) %>%
dplyr::left_join(index_tbl, by=c("symbol"="index_symbol", "date"="date"))
index_tbl
firm_tbl %>%
dplyr::left_join(request_join_idx_tbl, by = c("symbol" = "firm_symbol")) %>%
dplyr::left_join(index_tbl, by=c("index_symbol"="symbol", "date"="date"))
firm_tbl
source("~/projects/privat/EventStudy/R/task.R")
est_task = EventStudyTask$new(firm_tbl, index_tbl, request_tbl)
source("~/projects/privat/EventStudy/R/task.R")
est_task = EventStudyTask$new(firm_tbl, index_tbl, request_tbl)
firm_stock_data_tbl
reference_tbl
request_tbl
# Join index data to firm data
firm_stock_data_tbl = firm_stock_data_tbl %>%
private$append_index_tbl(reference_tbl, request_tbl)
debug(private$append_index_tbl)
# Join index data to firm data
firm_stock_data_tbl = firm_stock_data_tbl %>%
private$append_index_tbl(reference_tbl, request_tbl)
# Link between stock data and referecne data is given in the request file
# Multiple reference data sources are not supported yet.
request_tbl %>%
dplyr::select(firm_symbol, index_symbol) -> request_join_idx_tbl
request_join_idx_tbl
firm_tbl
firm_tbl %>%
dplyr::left_join(request_join_idx_tbl, by = "firm_symbol")
index_tbl
reference_tbl
reference_tbl
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
est_task = EventStudyTask$new(firm_tbl, index_tbl, request_tbl)
rlang::last_trace()
source("~/projects/privat/EventStudy/R/task.R")
est_task = EventStudyTask$new(firm_tbl, index_tbl, request_tbl)
firm_stock_data_tbl
request_tbl
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
est_task = EventStudyTask$new(firm_tbl, index_tbl, request_tbl)
est_task
est_task$data_tbl
request_tbl
firm_tbl
source("~/projects/privat/EventStudy/R/prepare_event_study.R")
est_task = prepare_event_study(est_task, param_set)
source("~/projects/privat/EventStudy/R/execute.R")
est_task = execute_model(est_task, param_set)
est_task = execute_single_event_statistics(est_task, param_set)
task$data_tbl = task$data_tbl %>%
mutate(model = furrr::future_map(.x=data,
.f=.initialize_and_fit_model,
return_model=parameter_set$return_model))
est_task = execute_model(est_task, param_set)
source("~/projects/privat/EventStudy/R/execute.R")
est_task = execute_model(est_task, param_set)
market_model
market_model$is_fitted
market_model$fit(data_tbl)
debug(market_model$fit)
market_model$fit(data_tbl)
data_tbl %>%
filter(estimation_window == 1) -> estimation_tbl
# safe execution
safe_mm = purrr::safely(.f=.estimate_mm_model)
safe_mm
res = safe_mm(firm_returns ~ index_returns, estimation_tbl)
is.null(res$error)
private$.fitted_model = fitted_model
private$.is_fitted = TRUE
# Calculate statistics
private$calculate_statistics(data_tbl)
private$.fitted_model
private$.fitted_model
private$.fitted_model
private$.fitted_model = fitted_model
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
est_task = execute_model(est_task, param_set)
source("~/projects/privat/EventStudy/R/execute.R")
market_model$fit(data_tbl)
source("~/projects/privat/EventStudy/R/models.R")
est_task = execute_model(est_task, param_set)
source("~/projects/privat/EventStudy/R/models.R")
est_task = execute_model(est_task, param_set)
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
est_task = execute_model(est_task, param_set)
source("~/projects/privat/EventStudy/R/models.R")
source("~/projects/privat/EventStudy/R/models.R")
market_model = MarketModel$new()
# Define single event test statistic
ar_test = ARTTest$new()
car_test = CARTTest$new()
# Setup parameter set
param_set = ParameterSet$new(return_calculation  = log_return,
return_model        = market_model,
ar_test_statistics  = ar_test,
car_test_statistics = car_test)
est_task = EventStudyTask$new(firm_tbl, index_tbl, request_tbl)
est_task = prepare_event_study(est_task, param_set)
est_task = execute_model(est_task, param_set)
est_task = execute_single_event_statistics(est_task, param_set)
est_task$firm_tbl$ar_statistics
est_task$firm_tbl$car_statistics
est_task$data_tbl$ar_statistics
est_task$data_tbl$car_statistics
est_task$data_tbl$car_statistics[[1]] %>%
ggplot(aes(x=relative_index, y=car)) +
geom_line()
library(ggplot2)
est_task$data_tbl$car_statistics[[1]] %>%
ggplot(aes(x=relative_index, y=car)) +
geom_line()
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/task.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
source("~/projects/privat/EventStudy/R/execute.R")
roxygen2::roxygenise()
warnings()
roxygen2::roxygenise()
